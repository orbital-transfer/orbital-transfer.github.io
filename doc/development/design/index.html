<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Design</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link rel="stylesheet" href="../../../style.css" type="text/css" />

<link rel="stylesheet" href="../../../local.css" type="text/css" />










</head>
<body>

<div class="page">

<div class="pageheader">
<div class="header">
<span>
<span class="parentlinks">

<a href="../../../">Orbital Transfer</a>/ 

<a href="../../">doc</a>/ 

<a href="../">development</a>/ 

</span>
<span class="title">
Design

</span>
</span>



</div>


<div class="actions">
<ul>


<li><a href="../../../recentchanges/">RecentChanges</a></li>


<li><a rel="nofollow" href="https://github.com/orbital-transfer/orbital-transfer.github.io/commits/source/doc/development/design/index.mdwn">History</a></li>







</ul>
</div>








</div>



<div class="sidebar">
<ul>
    <li><a href="../../">Documentation</a></li>
    <ul>
        <li><a href="../">Development</a></li>
    </ul>
</ul>

</div>



<div id="pagebody">

<div id="content" role="main">
<h1 id="bootstrapping">Bootstrapping</h1>

<ul>
<li>Current
<ul>
<li>config:
<ul>
<li>Install directory
<ul>
<li>global install: no directory specified (so installs to <code>perl -V:sitelib</code>)</li>
<li>CI install: in <code>~/.orbital</code>.
<ul>
<li>Only when $ENV{CI} is true</li>
</ul></li>
<li>default: relative to launch-site repo</li>
</ul></li>
</ul></li>
<li>steps:
<ol>
<li>Install <code>cpm</code> (from vendor submodules) if not available</li>
<li>Install <code>cpanm</code> using <code>cpm</code>.</li>
<li>Install <code>App::scan_prereqs_cpanfile</code> using <code>cpanm</code>.</li>
<li>Generate a <code>cpanfile</code> for every orbital-transfer submodule.</li>
<li>Install dependencies from <code>cpanfile</code> for every orbital-transfer
submodule using <code>cpm</code> then <code>cpanm</code>.</li>
</ol></li>
</ul></li>
<li>Future
<ul>
<li>config:
<ul>
<li>Install to directory, upload to GitHub
<ul>
<li>upload to GitHub for cacheing</li>
</ul></li>
<li>Install to directory at bootstrap time
<ul>
<li>determine the directory to install to using a class</li>
</ul></li>
</ul></li>
<li>steps: same as before
<ul>
<li>Perhaps need to generate cpanfile in each repo, only install and run
<code>App::scan_prereqs_cpanfile</code> if <code>cpanfile</code> missing.</li>
</ul></li>
<li>decreasing deps:
<ul>
<li>Need to outline a set of modules that are pure-Perl or can be translated
to pure-Perl equivalents.</li>
<li>Some of these can be installed as the base dependencies of all the
Orbital::Payload::* modules.</li>
<li>Others need to be set up to be installed based on context:
<ul>
<li>e.g., if loading on GitHub actions, then load everything needed there</li>
</ul></li>
<li>Create a way of specifying features that require different sets of
modules in a distribution.</li>
<li>Use a loader function to look up the features needed by a module and
install if necessary.</li>
<li>Need to have a context for installation and loading which holds the
directories for bootstrapping.</li>
</ul></li>
</ul></li>
</ul>

<h1 id="workflowgraph">Workflow graph</h1>

<ul>
<li>Task
<ul>
<li>Something that can be run.
<ul>
<li><code>exec()</code> calls</li>
<li>code</li>
</ul></li>
<li>Can succeed or fail.
<ul>
<li>A future?</li>
</ul></li>
<li>Has dependencies.</li>
<li>Has inputs / outputs
<ul>
<li>Can be variables (e.g., parameters), directories, files</li>
<li>Outputs: stdout/stderr</li>
</ul></li>
<li>Dependency graph:
<ul>
<li>e.g., Task B depends on A.output0</li>
</ul></li>
<li>Tasks can have a mergeable role.</li>
<li>Tasks can have a retryable role.</li>
<li>Tasks can have subtasks?
<ul>
<li>A graph of subtasks?</li>
</ul></li>
<li>Can have specialised tasks for CIs
<ul>
<li>e.g., on GitHub Actions, this would indicate which
OS the task is running on</li>
</ul></li>
</ul></li>
<li>Resources
<ul>
<li>lockable / mutex
<ul>
<li>Some resources can only be accessed for writing by one task at a time,
e.g., installing CPAN modules to a library directory, running apt-get.</li>
</ul></li>
</ul></li>
<li>Scheduling
<ul>
<li><a href="https://en.wikipedia.org/wiki/Coffman&ndash;Graham_algorithm">https://en.wikipedia.org/wiki/Coffman–Graham_algorithm</a></li>
<li><a href="https://metacpan.org/pod/Bencher::Scenario::GraphTopologicalSortModules">https://metacpan.org/pod/Bencher::Scenario::GraphTopologicalSortModules</a>
<ul>
<li><a href="https://metacpan.org/pod/Data::Graph::Util">https://metacpan.org/pod/Data::Graph::Util</a></li>
<li><a href="https://metacpan.org/pod/Algorithm::Dependency">https://metacpan.org/pod/Algorithm::Dependency</a></li>
</ul></li>
</ul></li>
<li>Workflow graph
<ul>
<li>DAG
<ul>
<li>Maybe in the future use strongly connected components to do
condensation of any directed graph?</li>
</ul></li>
</ul></li>
<li><code>Task::Apt::Install</code>
<ul>
<li>Definition of <code>Task::Apt::Install</code>
<ul>
<li><code>apt-get install [-y] [package-list]</code>
<ul>
<li>where <code>-y</code> option is boolean and optional.</li>
<li>where <code>package-list</code> option is array and required.</li>
</ul></li>
</ul></li>
<li>Given two tasks of type <code>Task::Apt::Install</code>,
<ul>
<li>Mutually exclusive: can not run multiple instances of
<code>Task::Apt::Install</code> at the same time since they all require
access to the <code>dpkg</code> lock.</li>
<li>Mergeable: if the options other than <code>package-list</code> are the same,
then they can be merged by merging the arrays of <code>package-list</code>.</li>
</ul></li>
</ul></li>
<li>Package (or Pkg)
<ul>
<li>An installable unit.</li>
<li>What gets installed varies by package type (different packaging
management systems).</li>
<li>Has dependencies.</li>
<li>Dependencies should be resolvable.</li>
</ul></li>
</ul>

<h1 id="organisationofproject">Organisation of project</h1>

<ul>
<li>Payload:
<ul>
<li>Env (for Environment):
<ul>
<li>Language</li>
<li>DB (e.g., PostgreSQL, MySQL)</li>
<li>XWindows</li>
</ul></li>
<li>Sys (for System):
<ul>
<li>Operating system</li>
<li>Package management system</li>
</ul></li>
<li>Serv (for Service):
<ul>
<li>Usually a web service</li>
</ul></li>
<li>VCS: version control system
<ul>
<li>git, bzr, svn, cvs, etc.</li>
</ul></li>
</ul></li>
<li>database
<ul>
<li><code>pkg/</code>: packages. These can be from source (for FOSS code) or binary-only (for proprietary code).
<ul>
<li>e.g., <code>pkg/gui/gtk3</code>
<ul>
<li>inside of this create definitions such as <pre> 
use Orbitalfile -api =&gt; v1;
 
def_pkg {
  meta {
    type 'library';
    homepage 'https://www.gtk.org/';
    vcs 'git', {
      uri 'git@gitlab.gnome.org:GNOME/gtk.git', protocol =&gt; 'ssh';
      uri 'https://gitlab.gnome.org/GNOME/gtk.git', protocol =&gt; 'https';
    };
    vcs 'git', {
      type =&gt; 'mirror';
      uri 'https://github.com/GNOME/gtk.git', protocol =&gt; 'https';
    };
    bug_tracker 'https://gitlab.gnome.org/GNOME/gtk/-/issues';
  };
 
  requires env('c');
 
  provides env('c')-&gt;library('gtk3') {
    header_file('gtk/gtk.h', type =&gt; 'main');
    pkg_config 'gtk+-3.0';
  };
 
  def apt('libgtk-3-0') {
    # implied to apply to all versions of apt package
    # version '*';
 
    requires dist('debian') | dist('ubuntu');
    provides os('linux')-&gt;shared_library;
  };
 
  def apt('libgtk-3.0-dev') {
    requires dist('debian') | dist('ubuntu');
    provides env('c')-&gt;headers;
  };
 
  def homebrew('gtk+3') {
    requires os('macos');
    provides os('macos')-&gt;shared_library;
    provides env('c')-&gt;headers;
  }
}
</pre></li>
</ul></li>
<li>e.g., <code>pkg/perl/Gtk3</code> for <a href="https://p3rl.org/Gtk3">https://p3rl.org/Gtk3</a>
<ul>
<li>depends on <code>pkg/gui/gtk3</code> with feature :glib-introspection</li>
</ul></li>
<li>Need a mapper from external packages to database.
<ul>
<li>e.g., <code>CPANPackage(&#036;Name) -&gt; Pkg('main:pkg/perl/&#036;Name')</code></li>
<li>must be overrideable: in case a fork needs to be used or in the example of Perl, an <a href="https://p3rl.org/Alt">https://p3rl.org/Alt</a> module.</li>
</ul></li>
</ul></li>
<li><code>sys/</code>: os  package manager + distribution
<ul>
<li>e.g., sys/os/{windows,linux,macos}</li>
<li>e.g., sys/dist/{debian,ubuntu}, sys/dist/fedora</li>
<li>e.g., sys/dist/{msys2,chocolatey}</li>
<li>e.g., sys/dist/{homebrew,fink,macports}</li>
<li>e.g., <code>sys/arch/{intel,arm}</code></li>
</ul></li>
<li><code>env/</code>: language {perl,python,go}
<ul>
<li>env/perl/dist/Strawberry</li>
<li>env/python/dist/Anaconda</li>
</ul></li>
<li><code>role/</code>: BLAS-interface, LAPACK-interface, XWindows-server, SQL-server, web-browser
<ul>
<li>e.g., role/server/xwindows: provided by Xorg, Xephyr, Xvfb</li>
</ul></li>
</ul></li>
<li>databases should be layered:
<ul>
<li>p5-Orbital-Transfer-Database distributes core database with OS, Language, Architecture files
<ul>
<li>actually stored in <code>orbital-transfer-database/core</code></li>
</ul></li>
<li><code>orbital-transfer-database/main</code> contains database with packages such as <code>pkg/gui/gtk3</code>.</li>
</ul></li>
</ul>

<h1 id="ciofprojectmodules">CI of project modules</h1>

<ul>
<li>Pull from <code>launch-site</code>.</li>
<li>For every repo in { <code>GITHUB_SHA</code>, <code>cpanfile-git</code> } and <code>launch-site/vendor/</code>,
checkout the version of that repo.</li>
</ul>

<h1 id="roadmap">Roadmap</h1>

<ul>
<li>Query package database.</li>
<li>Directory can be specified as local FS or remote URL.</li>
<li>Query dependencies for directory.
<ul>
<li>Need language-specific scanner.</li>
<li>Read from meta files.</li>
</ul></li>
<li>List platforms supported.</li>
<li>Query platform package databases.</li>
<li>REPL for working with objects</li>
</ul>

</div>







</div>

<div id="footer" class="pagefooter" role="contentinfo">

<div id="pageinfo">











<div class="pagedate">
Last edited <span class="date">Tue Aug 17 02:38:09 2021</span>
<!-- Created <span class="date">Sun Jan 24 05:22:03 2021</span> -->
</div>

</div>


<!-- from Orbital Transfer -->
</div>

</div>

</body>
</html>
