<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Continuous integration</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link rel="stylesheet" href="../../../style.css" type="text/css" />

<link rel="stylesheet" href="../../../local.css" type="text/css" />










</head>
<body>

<div class="page">

<div class="pageheader">
<div class="header">
<span>
<span class="parentlinks">

<a href="../../../">Orbital Transfer</a>/ 

<a href="../../">doc</a>/ 

<a href="../">development</a>/ 

</span>
<span class="title">
Continuous integration

</span>
</span>



</div>


<div class="actions">
<ul>


<li><a href="../../../recentchanges/">RecentChanges</a></li>


<li><a rel="nofollow" href="https://github.com/orbital-transfer/orbital-transfer.github.io/commits/source/doc/development/continuous-integration/index.mdwn">History</a></li>







</ul>
</div>








</div>



<div class="sidebar">
<ul>
    <li><a href="../../">Documentation</a></li>
    <ul>
        <li><a href="../">Development</a></li>
    </ul>
</ul>

</div>



<div id="pagebody">

<div id="content" role="main">
<h1 id="overview">Overview</h1>

<ul>
<li><a href="https://en.wikipedia.org/wiki/Comparison_of_continuous_integration_software">Comparison of continuous integration software - Wikipedia</a></li>
</ul>

<h1 id="designofciconfiguration">Design of CI configuration</h1>

<ul>
<li>Script
<ul>
<li>Bourne shell script</li>
<li>PowerShell script</li>
</ul></li>
<li><p>Script should be source-able using the same script for every CI service
(because generating multiple scripts means changing those scripts). Then the
script in turn should do something different based on which CI is being used
(detected using the environment variables).</p></li>
<li><p>Steps for CI should have information on how to retrieve modules/distributions.
For example, inside a monorepo this is a directory.</p></li>
</ul>

<h2 id="caching">Caching</h2>

<ul>
<li>Caching inside of a single CI system: this can be used for artifacts that
are created internally to the build that can be rebuilt as long as inputs do
not change.
<ul>
<li>e.g., for a given repo, the dependencies installed from CPAN</li>
</ul></li>
<li><p>Caching outside of the CI system: some build artifacts can be stored outside
of the CI caching mechanism so that they can be shared across repos.</p>

<ol>
<li>Given
<ol>
<li>Projects { P_A, P_B }</li>
<li>Tasks { Task₀, Task₁ }</li>
<li>OS <em>os</em> and architecture <em>arch</em> (determined by what the workflow is running on); (ignoring APIs/ABIs for now)</li>
</ol></li>
<li>VersionString(P_A) = V_A, VersionString(P_B) = V_B
<ol>
<li>e.g., using <code>git describe --always</code></li>
</ol></li>
<li>Task₀(P_A) has output A_O₀{V_A, <em>os</em>,<em>arch</em>}.</li>
<li>Where Task₁(P_B) running on {<em>os</em>,<em>arch</em>} depends on A_O₀{V_A,<em>os</em>,<em>arch</em>}
<ol>
<li>V_A for P_B is determined by turning a project dependency such as <code>P_B
has-runtime-dependency-on (P_A where P_A source is git:A @ master)</code>
into a concrete dependency.</li>
</ol></li>
</ol>

<p>Specifically on GitHub:</p>

<ul>
<li>Workflow running on every push, pull request:
<ol>
<li>We can store A_O₀{V_A,<em>os</em>,<em>arch</em>} as a GitHub
release under tag <code>continuous-build</code> when finished running
Task₀(P_A) under the CI workflow for P_A for the default/release branch (e.g.,
master).</li>
<li>When running Task₁(P_B) under the CI workflow for P_B, retrieve A_O₀{V_A,<em>os</em>,<em>arch</em>}
from GitHub releases if it exists. Otherwise build A_O₀{V_A,<em>os</em>,<em>arch</em>}
inside of the CI workflow.</li>
</ol></li>
<li>Workflow running on every tag creation:
<ol>
<li>When running Task₀(P_A) under the CI workflow for P_A, delete all
A_O₀{Version,Os,Arch} where Version &lt; VersionString(P_A).</li>
</ol></li>
</ul></li>
</ul>

<h2 id="multipleversiontesting">Multiple version testing</h2>

<p>For example, say you want to test a binding library B that binds to library A
(e.g., FFI-based binding).</p>

<ul>
<li>You can build and install all different versions of A in parallel into different folders.</li>
<li>You only need to build the dependencies of library B once since they do not
depend on library A.</li>
<li>You build library B with a different path to test each version.</li>
</ul>

<h2 id="examples">Examples</h2>

<ul>
<li> Travis CI:
<div class="highlight-yml"><pre class="hl"> 
<span class="hl kwa">install:</span> skip
<span class="hl kwa">script:</span> eval <span class="hl str">&quot;$(curl .../bootstrap.sh)&quot;</span>

</pre></div>
</li>
<li> AppVeyor:
<div class="highlight-yml"><pre class="hl"> 
<span class="hl kwa">build:</span> off
<span class="hl kwa">test_script:</span>
  - <span class="hl kwa">ps:</span> . { iwr -useb .../bootstrap.ps<span class="hl num">1</span> } <span class="hl opt">|</span> iex

</pre></div>
</li>
<li>
GitHub Actions:
<div class="highlight-yml"><pre class="hl"> 
<span class="hl kwa">jobs:</span>
  <span class="hl kwa">build:</span>
    runs-<span class="hl kwa">on:</span> ubuntu-latest
    <span class="hl kwa">steps:</span>
      - <span class="hl kwa">uses:</span> actions/checkout&#64;v<span class="hl num">2</span>
      - <span class="hl kwa">name:</span> Run Orbital Transfer
        <span class="hl kwa">run:</span> <span class="hl opt">|</span>
          eval <span class="hl str">&quot;$(curl .../bootstrap.sh)&quot;</span>

</pre></div>
</li>
</ul>

<h1 id="services">Services</h1>

<h2 id="githubactions">GitHub Actions</h2>

<ul>
<li><p>Reference: <a href="https://docs.github.com/en/free-pro-team@latest/actions/reference">https://docs.github.com/en/free-pro-team@latest/actions/reference</a>.</p></li>
<li><p>Events</p>

<ul>
<li><a href="https://docs.github.com/en/actions/reference/events-that-trigger-workflows">https://docs.github.com/en/actions/reference/events-that-trigger-workflows</a></li>
<li>Scheduled actions
<ul>
<li><a href="https://jasonet.co/posts/scheduled-actions/">https://jasonet.co/posts/scheduled-actions/</a></li>
</ul></li>
</ul></li>
<li>Installed software in each environment: <a href="https://github.com/actions/virtual-environments">https://github.com/actions/virtual-environments</a></li>
<li>Storing artifacts inside of a workflow <a href="https://docs.github.com/en/free-pro-team@latest/actions/guides/storing-workflow-data-as-artifacts">https://docs.github.com/en/free-pro-team@latest/actions/guides/storing-workflow-data-as-artifacts</a>.</li>
<li>Caching <a href="https://docs.github.com/en/free-pro-team@latest/actions/guides/caching-dependencies-to-speed-up-workflows">https://docs.github.com/en/free-pro-team@latest/actions/guides/caching-dependencies-to-speed-up-workflows</a>.
<ul>
<li><a href="https://github.com/actions/cache/blob/main/examples.md">https://github.com/actions/cache/blob/main/examples.md</a></li>
<li>Clearing cache: <a href="https://stackoverflow.com/questions/63521430/clear-cache-in-github-actions">https://stackoverflow.com/questions/63521430/clear-cache-in-github-actions</a></li>
<li><a href="https://stackoverflow.com/questions/64226272/caching-npm-dependency-with-github-action">https://stackoverflow.com/questions/64226272/caching-npm-dependency-with-github-action</a></li>
<li><a href="https://github.com/turtlebrowser/conan-cache">https://github.com/turtlebrowser/conan-cache</a></li>
</ul></li>
<li>Container registry <a href="https://github.blog/2020-09-01-introducing-github-container-registry/">https://github.blog/2020-09-01-introducing-github-container-registry/</a>
<ul>
<li><a href="https://docs.github.com/en/free-pro-team@latest/packages/getting-started-with-github-container-registry/about-github-container-registry">https://docs.github.com/en/free-pro-team@latest/packages/getting-started-with-github-container-registry/about-github-container-registry</a></li>
</ul></li>
<li>Problem matcher <a href="https://github.com/actions/toolkit/blob/master/docs/problem-matchers.md">https://github.com/actions/toolkit/blob/master/docs/problem-matchers.md</a></li>
<li>Runner OS <a href="https://stackoverflow.com/questions/57946173/github-actions-run-step-on-specific-os">https://stackoverflow.com/questions/57946173/github-actions-run-step-on-specific-os</a></li>
<li>Debugging with SSH <a href="https://github.com/marketplace/actions/debugging-with-tmate">https://github.com/marketplace/actions/debugging-with-tmate</a>, <a href="https://github.com/mxschmitt/action-tmate">https://github.com/mxschmitt/action-tmate</a>
<ul>
<li>Security: <a href="https://github.com/mxschmitt/action-tmate/issues/2">https://github.com/mxschmitt/action-tmate/issues/2</a></li>
<li>On failure: <a href="https://gist.github.com/mikedep333/4b58843923ac909b48b95c99c32d03af">https://gist.github.com/mikedep333/4b58843923ac909b48b95c99c32d03af</a></li>
</ul></li>
<li>Calling another action from within another action
<ul>
<li>Examples
<ul>
<li><a href="https://github.com/msys2/setup-msys2/blob/master/main.js">https://github.com/msys2/setup-msys2/blob/master/main.js</a></li>
<li><a href="https://github.com/lukka/get-cmake">https://github.com/lukka/get-cmake</a></li>
<li><a href="https://github.com/marketplace/actions/run-vcpkg">https://github.com/marketplace/actions/run-vcpkg</a></li>
</ul></li>
<li><a href="https://github.community/t/call-an-action-from-another-action/17524/2">https://github.community/t/call-an-action-from-another-action/17524/2</a></li>
<li><a href="https://stackoverflow.com/questions/58860769/call-a-github-action-from-another-github-action">https://stackoverflow.com/questions/58860769/call-a-github-action-from-another-github-action</a></li>
<li><a href="https://stackoverflow.com/questions/58611841/how-can-i-reference-other-actions-from-my-github-actions-action-yml-file">https://stackoverflow.com/questions/58611841/how-can-i-reference-other-actions-from-my-github-actions-action-yml-file</a></li>
</ul></li>
</ul>

<p>Actions:</p>

<ul>
<li>MSYS2:
<ul>
<li><a href="https://github.com/actions/starter-workflows/issues/95">https://github.com/actions/starter-workflows/issues/95</a></li>
<li><a href="https://github.com/msys2/setup-msys2">https://github.com/msys2/setup-msys2</a></li>
<li><a href="https://github.com/actions/virtual-environments/issues/1525">https://github.com/actions/virtual-environments/issues/1525</a></li>
<li><a href="https://github.com/actions/virtual-environments/issues/1572">https://github.com/actions/virtual-environments/issues/1572</a></li>
</ul></li>
</ul>

<p>Examples:</p>

<ul>
<li>Perl
<ul>
<li><a href="https://perlmaven.com/github-actions-running-on-3-operating-systems">https://perlmaven.com/github-actions-running-on-3-operating-systems</a></li>
<li><a href="https://github.com/tobyink/p5-app-ghaprove/blob/master/.github/workflows/ci.yml">https://github.com/tobyink/p5-app-ghaprove/blob/master/.github/workflows/ci.yml</a>
<ul>
<li>Note: this uses separate stages for authoring the distribution and
installing distribution. This way it is only authored once.</li>
</ul></li>
<li><a href="https://github.com/graphviz-perl/GraphViz2/blob/master/.github/workflows/ci.yml">https://github.com/graphviz-perl/GraphViz2/blob/master/.github/workflows/ci.yml</a></li>
</ul></li>
</ul>

<h2 id="travisci">Travis CI</h2>

<ul>
<li>Build stages <a href="https://docs.travis-ci.com/user/build-stages/">https://docs.travis-ci.com/user/build-stages/</a>.</li>
<li>Storing artifacts inside of stages <a href="https://docs.travis-ci.com/user/using-workspaces/">https://docs.travis-ci.com/user/using-workspaces/</a>.</li>
<li><a href="https://www.jeffgeerling.com/blog/2020/travis-cis-new-pricing-plan-threw-wrench-my-open-source-works">https://www.jeffgeerling.com/blog/2020/travis-cis-new-pricing-plan-threw-wrench-my-open-source-works</a></li>
</ul>

<h2 id="appveyor">AppVeyor</h2>

<ul>
<li><a href="https://www.appveyor.com/docs/environment-variables/">Environment variables - AppVeyor</a>
<ul>
<li>e.g., for build folder in PowerShell, use <code>&#036;Env:APPVEYOR_BUILD_FOLDER</code></li>
</ul></li>
<li><a href="https://www.appveyor.com/docs/windows-images-software/">Software pre-installed on Windows build VMs - AppVeyor</a></li>
</ul>

<h2 id="gitlabci">GitLab CI</h2>

<ul>
<li>Cronjobs
<ul>
<li><a href="https://tonyxu.io/posts/2018/use-gitlab-ci-to-run-free-scheduled-jobs/">https://tonyxu.io/posts/2018/use-gitlab-ci-to-run-free-scheduled-jobs/</a></li>
<li><a href="https://medium.com/@Maxime_/get-free-cron-jobs-with-gitlab-78f57e086453">https://medium.com/@Maxime_/get-free-cron-jobs-with-gitlab-78f57e086453</a></li>
</ul></li>
</ul>

<h1 id="commonfeatures">Common features</h1>

<ul>
<li>Skipping commits by using directive in commit message:
<ul>
<li>e.g., <code>[skip ci]</code>, <code>[ci skip]</code>.</li>
<li>GHA: <a href="https://github.blog/changelog/2021-02-08-github-actions-skip-pull-request-and-push-workflows-with-skip-ci/">https://github.blog/changelog/2021-02-08-github-actions-skip-pull-request-and-push-workflows-with-skip-ci/</a></li>
</ul></li>
<li>CI environment information
<ul>
<li><a href="https://github.com/watson/ci-info">https://github.com/watson/ci-info</a></li>
<li><a href="https://metacpan.org/pod/Test::CI">https://metacpan.org/pod/Test::CI</a></li>
</ul></li>
</ul>

</div>







</div>

<div id="footer" class="pagefooter" role="contentinfo">

<div id="pageinfo">






<div id="backlinks">
Links:

<a href="../../../">index</a>


</div>






<div class="pagedate">
Last edited <span class="date">Sun Aug  8 00:57:35 2021</span>
<!-- Created <span class="date">Sun Nov 15 00:02:54 2020</span> -->
</div>

</div>


<!-- from Orbital Transfer -->
</div>

</div>

</body>
</html>
